{{ $images := $.Resources.ByType "image" }}
{{ $featured := $images.GetMatch "*feature*" }}
{{ if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end }}
{{ if not $featured }}
 {{ $baseImage := resources.Get "opengraph/gohugoio-card-base-1.png" }}
 {{ $font := resources.Get "fonts/BerkeleyMono-Bold.ttf" }}
 {{ $title := "" }}
 {{ with $.LinkTitle }}{{ $title = . }}{{ else }}{{ with $.Title }}{{ $title = . }}{{ end }}{{ end }}

 {{ if and $baseImage $font $title }}
  {{ $featured = $baseImage }}
  {{ $size := 80 }}
  {{ if gt (len $title) 20 }}
  {{ $size = 70 }}
  {{ end }}

  {{ $textOptions := dict
     "color" "#FFF"
     "size" $size
     "lineSpacing" 10
     "x" 65 "y" 80
     "font" $font
  }}

  {{ $featured = $featured | images.Filter (images.Text $title $textOptions) }}
 {{ else }}
  {{ $featured = $baseImage }}
 {{ end }}
{{ end }}

{{ return $featured }}